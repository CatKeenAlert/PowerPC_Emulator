function init(e){e=typeof e!=="undefined"?e:true;if(e){var t=document.getElementById("programmcode").getElementsByTagName("tbody")[0];for(var n=100;n<=499;n++){var r=t.insertRow(t.rows.length);r.id="row"+n;if(n%2==0){var i=document.createElement("input");i.type="text";i.value="";i.setAttribute("class","input-small");i.placeholder="Befehl";i.setAttribute("onChange","updateProgrammCode(event);");i.id="code"+n}var s=document.createElement("input");s.type="text";s.value="";s.setAttribute("class","input-medium");s.placeholder="Maschinencode";s.id="code"+n+"Bin";s.disabled=true;var o=r.insertCell(0);o.appendChild(s);var o=r.insertCell(0);if(n%2==0){o.appendChild(i)}var o=r.insertCell(0);o.innerHTML=n}}var t=document.getElementById("inputvariables").getElementsByTagName("tbody")[0];for(var n=500;n<=529;n++){var r=t.insertRow(t.rows.length);r.id="row"+n;if(n%2==0){var u=document.createElement("input");u.type="text";u.value="";u.setAttribute("class","input-small");u.placeholder="Dezimal";u.setAttribute("onChange","updateInputValue(event);");u.id="input"+n}var a=document.createElement("input");a.type="text";a.value="";a.setAttribute("class","input-medium");a.placeholder="Binär";a.id="input"+n+"Bin";a.disabled=true;var o=r.insertCell(0);o.appendChild(a);var o=r.insertCell(0);if(n%2==0){o.appendChild(u)}var o=r.insertCell(0);o.innerHTML=n;n++;var r=t.insertRow(t.rows.length);var a=document.createElement("input");a.type="text";a.value="";a.setAttribute("class","input-medium");a.placeholder="Binär";a.id="input"+n+"Bin";a.disabled=true;var o=r.insertCell(0);o.appendChild(a);var o=r.insertCell(0);var o=r.insertCell(0);o.innerHTML=n}setPC(100);sc=0;setSCinGui();setAkku(0);setReg(0,1);setReg(0,2);setReg(0,3);setCarryFlag(false);endFlag=0}function loadTest(){init(false);setStorage("LWDD 0 #504",100);setStorage("SLA",102);setStorage("BCD #124",104);setStorage("LWDD 1 #502",106);setStorage("ADD 1",108);setStorage("SLA",110);setStorage("BCD #124",112);setStorage("SLA",114);setStorage("BCD #124",116);setStorage("LWDD 1 #500",116);setStorage("ADD 1",118);setStorage("BCD #124",120);setStorage("SWDD 0 #506",122);setStorage("STOP",124);setStorage(14,500);setStorage(7,502);setStorage(66,504)}function loadTestFail(){init(false);setStorage("LWDD 0 #504",100);setStorage("SLA",102);setStorage("BCD #124",104);setStorage("LWDD 1 #502",106);setStorage("ADD 1",108);setStorage("SLA",110);setStorage("BCD #124",112);setStorage("SLA",114);setStorage("BCD #124",116);setStorage("LWDD 1 #500",116);setStorage("ADD 1",118);setStorage("BCD #124",120);setStorage("SWDD 0 #506",122);setStorage("STOP",124);setStorage(-125,500);setStorage(1e4,502);setStorage(16,504)}function multiplication(){init(false);setResultField(504,1);setResultField(506,2);setResult(dec2twocomplement(0,32));var e=150;var t=180;var n=240;var r=270;var i=300;var s=350;var o=400;var u=450;var a=480;var f=100;setStorage("LWDD 0 #500",f);f=f+2;setStorage("BZD #"+a,f);f=f+2;setStorage("SLL",f);f=f+2;setStorage("BCD #"+e,f);f=f+2;setStorage("SRL",f);f=f+2;setStorage("SWDD 0 #514",f);f=f+2;checkNumber2=f;setStorage("LWDD 0 #502",f);f=f+2;setStorage("BZD #"+a,f);f=f+2;setStorage("SLL",f);f=f+2;setStorage("BCD #"+t,f);f=f+2;setStorage("SRL",f);f=f+2;setStorage("SWDD 0 #510",f);f=f+2;shiftFlag=f;setStorage("LWDD 0 #508",f);f=f+2;setStorage("INC",f);f=f+2;setStorage("SWDD 0 #508",f);f=f+2;setStorage("LWDD 0 #510",f);f=f+2;setStorage("BZD #"+u,f);f=f+2;setStorage("SRA",f);f=f+2;setStorage("SWDD 0 #510",f);f=f+2;setStorage("BCD #"+n,f);f=f+2;setStorage("BD #"+shiftFlag,f);f=f+2;setStorage("CLR 3",e);f=e;f=f+2;setStorage("LWDD 0 #500",f);f=f+2;setStorage("DEC",f);f=f+2;setStorage("NOT",f);f=f+2;setStorage("SWDD 0 #514",f);f=f+2;setStorage("LWDD 0 #516",f);f=f+2;setStorage("INC",f);f=f+2;setStorage("SWDD 0 #516",f);f=f+2;setStorage("BD #"+checkNumber2,f);f=f+2;setStorage("CLR 3",t);f=t;f=f+2;setStorage("LWDD 0 #502",f);f=f+2;setStorage("DEC",f);f=f+2;setStorage("NOT",f);f=f+2;setStorage("SWDD 0 #510",f);f=f+2;setStorage("LWDD 0 #516",f);f=f+2;setStorage("BNZD #"+r,f);f=f+2;setStorage("INC",f);f=f+2;setStorage("SWDD 0 #516",f);f=f+2;setStorage("BD #"+shiftFlag,f);f=f+2;setStorage("DEC",r);f=r;f=f+2;setStorage("SWDD 0 #516",f);f=f+2;setStorage("BD #"+shiftFlag,f);f=f+2;setStorage("CLR 3",n);f=n;f=f+2;multiplicationLoopFlag=f;setStorage("LWDD 0 #508",f);f=f+2;setStorage("BZD #"+s,f);f=f+2;setStorage("DEC",f);f=f+2;setStorage("SWDD 0 #508",f);f=f+2;setStorage("LWDD 0 #514",f);f=f+2;setStorage("SLL",f);f=f+2;setStorage("SWDD 0 #514",f);f=f+2;setStorage("LWDD 0 #512",f);f=f+2;setStorage("BCD #"+i,f);f=f+2;setStorage("SLA",f);f=f+2;setSecondPartContinue=f;setStorage("SWDD 0 #512",f);f=f+2;setStorage("BD #"+multiplicationLoopFlag,f);f=f+2;setStorage("CLR 3",i);f=i;f=f+2;setStorage("SLA",f);f=f+2;setStorage("INC",f);f=f+2;setStorage("BD #"+setSecondPartContinue,f);f=f+2;setStorage("LWDD 0 #512",s);f=s;f=f+2;setStorage("LWDD 1 #504",f);f=f+2;setStorage("ADD 1",f);f=f+2;setStorage("SWDD 0 #504",f);f=f+2;interimResultSecond=f;setStorage("LWDD 0 #514",interimResultSecond);f=interimResultSecond;f=f+2;setStorage("LWDD 1 #506",f);f=f+2;setStorage("ADD 1",f);f=f+2;setStorage("SWDD 0 #506",f);f=f+2;setStorage("BCD #"+o,f);f=f+2;setStorage("BD #"+shiftFlag,f);f=f+2;setStorage("CLR 3",o);f=o;f=f+2;setStorage("LWDD 0 #504",f);f=f+2;setStorage("INC",f);f=f+2;setStorage("SWDD 0 #504",f);f=f+2;setStorage("BD #"+shiftFlag,f);f=f+2;setStorage("LWDD 0 #516",u);f=u;f=f+2;setStorage("BZD #"+a,f);f=f+2;setStorage("LWDD 0 #504",f);f=f+2;setStorage("NOT",f);f=f+2;setStorage("SWDD 0 #504",f);f=f+2;setStorage("LWDD 0 #506",f);f=f+2;setStorage("NOT",f);f=f+2;setStorage("INC",f);f=f+2;setStorage("SWDD 0 #506",f);f=f+2;setStorage("BD #"+a,f);f=f+2;setStorage("STOP",a);f=a;f=f+2;setStorage(1e3,500);setStorage(24576,502);setStorage(0,504);setStorage(0,506);setStorage(-1,508);setStorage(0,510);setStorage(0,512);setStorage(0,514);setStorage(0,516)}function stepForward(){runMnemonic(getStorage(getPC()))}function slow(){timer=setInterval(function(){if(endFlag==0){runMnemonic(getStorage(getPC()))}else{clearInterval(timer)}},100)}function stopInterval(){clearInterval(timer)}function fast(){while(endFlag==0){runMnemonic(getStorage(getPC()))}}function focusOn(e){$("#code"+e).focus();$("#row"+e).addClass("info");var t=e+1;$("#row"+t).addClass("info")}function removeFocus(e){$("#row"+e).removeClass("info");var t=e+1;$("#row"+t).removeClass("info")}function setPCinGui(){$("#commandPointer").val(pc);$("#commandPointerBin").val(dec2twocomplement(pc,16))}function incPC(){removeFocus(pc);setPC(pc+2)}function setPC(e){removeFocus(pc);pc=parseInt(e);setPCinGui();focusOn(e)}function getPC(){return pc}function setSCinGui(){$("#stepcounter").val(sc)}function incSC(){sc++;setSCinGui()}function setResultFieldinGui(e){$("#resultField"+e).val(resultFiled[e])}function setResultField(e,t){resultFiled[t]=parseInt(e);setResultFieldinGui(t)}function getResultField(e){return parseInt(resultFiled[e])}function setResultinGui(){var e=0;if(getResultField(1)>500&&getResultField(1)>500){e=dec2twocomplement(getStorage(getResultField(1)),16)+""+dec2twocomplement(getStorage(getResultField(2)),16)}else if(getResultField(1)>500){e=dec2twocomplement(getStorage(getResultField(1)),16)}else if(getResultField(2)>500){e=dec2twocomplement(getStorage(getResultField(2)),16)}setResult(e)}function setResult(e){$("#result").val(twocomplement2dec(e));$("#resultBin").val(e)}function setReginGui(e){$("#reg"+e).val(reg[e]);$("#reg"+e+"Bin").val(dec2twocomplement(reg[e],16))}function setReg(e,t){if(t==0){setAkku(parseInt(e))}else{reg[t]=parseInt(e);setReginGui(t)}}function getReg(e){if(e==0){return getAkku()}else{return parseInt(reg[e])}}function setAkkuinGui(){$("#akku").val(akku);$("#akkuBin").val(dec2twocomplement(akku,16))}function setAkku(e){akku=parseInt(e);if(akku>max||akku<min){setCarryFlag(true)}setAkkuinGui()}function getAkku(){return parseInt(akku)}function setCarryFlaginGui(){$("#carryFlag").attr("checked",carryFlag);if(carryFlag){$("#carryFlagRow").addClass("error")}else{$("#carryFlagRow").removeClass("error")}}function setCarryFlag(e){carryFlag=e;setCarryFlaginGui(e)}function getCarryFlag(){return carryFlag}function setStorage(e,t){storage[t]=e;if(t<500){var n="code"+t;$("#"+n).val(e);setProgrammCodeinGui(e,n,t)}else{var n="input"+t;$("#"+n).val(e);setInputValueinGui(e,n,t)}}function getStorage(e){return storage[e]}function setInputValueinGui(e,t,n){var r=dec2twocomplement(e,16);$("#"+t+"Bin").val(r.substring(0,8));var i=parseInt(n)+1;var s=t.replace(n,i);$("#"+s+"Bin").val(r.substring(8))}function setInputValueBin(e,t){if(e>=max||e<=min){alert("Input to big the range is "+min+" until "+max)}var n=new RegExp("[0-9]+","g");var r=t.match(n);var i=new RegExp("input","g");var s=new RegExp("akku","g");var o=new RegExp("reg","g");var u=new RegExp("commandPointer","g");if(i.test(t)){setStorage(e,r)}else if(s.test(t)){setAkku(e)}else if(s.test(t)){setReg(e,r)}else if(u.test(t)){setPC(e)}}function updateInputValue(e){var t=e.target.id;setInputValueBin(e.target.value,t)}function setProgrammCodeinGui(e,t,n){var r=mnemonic2machinecode(e);$("#"+t+"Bin").val(r.substring(0,8));var i=parseInt(n)+1;var s=t.replace(n,i);$("#"+s+"Bin").val(r.substring(8))}function setProgrammCodeBin(e,t){var n=new RegExp("[0-9]+","g");var r=t.match(n);setStorage(e,r)}function updateProgrammCode(e){var t=e.target.id;setProgrammCodeBin(e.target.value,t)}function dec2bin(e){return parseInt(e).toString(2)}function bin2dec(e){return parseInt(e,2)}function dec2twocomplement(e,t){if(e<0){var n=e.toString();var r=growToNumberOfDigits(dec2bin(n.substring(1)),t);var s="";for(i=0;i<r.length;i++){if(parseInt(r.substring(i,i+1))==1){s=s+"0"}else{s=s+"1"}}if(s.substr(s.length-1)==0){return s.substr(0,s.length-1)+"1"}else{res=parseInt(s,2)+1;return res.toString(2)}}else{return growToNumberOfDigits(dec2bin(e),t)}}function twocomplement2dec(e){var t=e.toString().substring(0,1);if(t==1){var n=parseInt(e,2)-1;n=dec2twocomplement(n,e.length);var r="";var s=0;for(i=0;i<n.length;i++){if(parseInt(n.substring(i,i+1))==1){r=r+"0";s++}else{r=r+"1"}}return"-"+bin2dec(r)}else{return bin2dec(e)}}function mnemonic2machinecode(e){var t=defineAction(e,false);return t}function runMnemonic(e){defineAction(e,true)}function defineAction(e,t){var n=new RegExp("[a-zA-Z]+","g");var r=e.match(n);var i="";var s="";if(r=="CLR"){var o=findRegister(e);i="CLR register: "+o;s="0000"+growToNumberOfDigits(dec2bin(o),2)+"1010000000";if(t){setReg(0,o);setCarryFlag(false);incPC()}}else if(r=="ADD"){var o=findRegister(e);i="ADD to register: "+o;s="0000"+growToNumberOfDigits(dec2bin(o),2)+"1110000000";if(t){var u=dec2twocomplement(getAkku(),16);var a=dec2twocomplement(getReg(o),16);var f="";var l=0;for(var c=u.length;c>0;c--){if(u.substring(c-1,c)==1&&a.substring(c-1,c)==1){if(l==1){f+="1";l=1}else{f+="0";l=1}}else if(u.substring(c-1,c)==1){if(l==1){f+="0";l=1}else{f+="1"}}else if(a.substring(c-1,c)==1){if(l==1){f+="0";l=1}else{f+="1"}}else{if(l==1){f+="1";l=0}else{f+="0"}}}var h="";for(var c=f.length;c>0;c--){h+=f.substring(c-1,c)}if(l==1){setCarryFlag(true)}else{setCarryFlag(false)}setAkku(twocomplement2dec(h));incPC()}}else if(r=="ADDD"){var p=new RegExp("[-]?[1-9]+","g");var d=parseInt(e.match(p));i="ADDD "+d;s="1"+dec2twocomplement(d,15);if(t){var v=getAkku()+parseInt(d);setAkku(v);incPC()}}else if(r=="INC"){i="INC";s="0000000100000000";if(t){var v=getAkku()+1;setAkku(v);incPC()}}else if(r=="DEC"){i="DEC";s="0000010000000000";if(t){var v=getAkku()-1;setAkku(v);incPC()}}else if(r=="LWDD"){var o=findRegister(e);var m=findAddress(e);i="LWDD from register: "+o+" to address "+m;s="0100"+growToNumberOfDigits(dec2bin(o),2)+growToNumberOfDigits(dec2bin(m),10);if(t){setReg(getStorage(m),o);incPC()}}else if(r=="SWDD"){var o=findRegister(e);var m=findAddress(e);i="SWDD to register: "+o+" from address "+m;s="0110"+growToNumberOfDigits(dec2bin(o),2)+growToNumberOfDigits(dec2bin(m),10);if(t){setStorage(getReg(o),m);incPC()}}else if(r=="SRA"){i="SRA";s="0000010100000000";if(t){var g=dec2twocomplement(getAkku(),16);var y=g.substring(g.length-1);var b=g.substring(0,1);var w=b+g.substring(0,g.length-1);if(y==0){setCarryFlag(false)}else{setCarryFlag(true)}setAkku(twocomplement2dec(w));incPC()}}else if(r=="SLA"){i="SLA";s="0000100000000000";if(t){var g=dec2twocomplement(getAkku(),16);var b=g.substring(0,1);var E=g.substring(1,2);var w=b+g.substring(2)+"0";if(E==0){setCarryFlag(false)}else{setCarryFlag(true)}setAkku(twocomplement2dec(w));incPC()}}else if(r=="SRL"){i="SRL";s="0000100100000000";if(t){var g=dec2twocomplement(getAkku(),16);var y=g.substring(g.length-1);var b="0";var w=b+g.substring(0,g.length-1);if(y==0){setCarryFlag(false)}else{setCarryFlag(true)}setAkku(twocomplement2dec(w));incPC()}}else if(r=="SLL"){i="SLL";s="0000110000000000";if(t){var g=dec2twocomplement(getAkku(),16);var b=g.substring(0,1);var S=g.substring(1);var w=g.substring(1)+"0";if(b==0){setCarryFlag(false)}else{setCarryFlag(true)}setAkku(twocomplement2dec(w));incPC()}}else if(r=="AND"){var o=findRegister(e);i="AND register: "+o;s="0000"+growToNumberOfDigits(dec2bin(o),2)+"1000000000";if(t){var u=dec2twocomplement(getAkku(),16);var a=dec2twocomplement(getReg(o),16);var f="";for(var c=0;c<u.length;c++){if(u.substring(c,c+1)==a.substring(c,c+1)){f+="1"}else{f+="0"}}setAkku(twocomplement2dec(f));incPC()}}else if(r=="OR"){var o=findRegister(e);i="OR register: "+o;s="0000"+growToNumberOfDigits(dec2bin(o),2)+"1100000000";if(t){var u=dec2twocomplement(getAkku(),16);var a=dec2twocomplement(getReg(o),16);var f="";for(var c=0;c<u.length;c++){if(u.substring(c,c+1)==1||a.substring(c,c+1)==1){f+="1"}else{f+="0"}}setAkku(twocomplement2dec(f));incPC()}}else if(r=="NOT"){i="NOT";s="0000000010000000";if(t){var u=dec2twocomplement(getAkku(),16);var f="";for(var c=0;c<u.length;c++){if(u.substring(c,c+1)==0){f+="1"}else{f+="0"}}setAkku(twocomplement2dec(f));incPC()}}else if(r=="BZ"){var o=findRegister(e);i="BZ register: "+o;s="0001"+growToNumberOfDigits(dec2bin(o),2)+"1000000000";if(t){if(getAkku()==0){setPC(getReg(o))}else{incPC()}}}else if(r=="BNZ"){var o=findRegister(e);i="BNZ register: "+o;s="0001"+growToNumberOfDigits(dec2bin(o),2)+"0100000000";if(t){if(getAkku()!=0){setPC(getReg(o))}else{incPC()}}}else if(r=="BC"){var o=findRegister(e);i="BC register: "+o;s="0001"+growToNumberOfDigits(dec2bin(o),2)+"1100000000";if(t){if(getCarryFlag()){setPC(getReg(o))}else{incPC()}}}else if(r=="B"){var o=findRegister(e);i="B register: "+o;s="0001"+growToNumberOfDigits(dec2bin(o),2)+"0000000000";if(t){setPC(getReg(o))}}else if(r=="BZD"){var m=findAddress(e);i="BZD to address "+m;s="001100"+growToNumberOfDigits(dec2bin(m),10);if(t){if(getAkku()==0){setPC(m)}else{incPC()}}}else if(r=="BNZD"){var m=findAddress(e);i="BNZD to address "+m;s="001010"+growToNumberOfDigits(dec2bin(m),10);if(t){if(getAkku()!=0){setPC(m)}else{incPC()}}}else if(r=="BCD"){var m=findAddress(e);i="BCD to address "+m;s="001110"+growToNumberOfDigits(dec2bin(m),10);if(t){if(getCarryFlag()){setPC(m)}else{incPC()}}}else if(r=="BD"){var m=findAddress(e);i="BD to address "+m;s="001000"+growToNumberOfDigits(dec2bin(m),10);if(t){setPC(m)}}else if(r=="STOP"){i="STOP";s="0000000000000000";if(t){endFlag=1;alert("END");setResultinGui();exit}}else{i="unknown command: "+e;alert(i)}if(s.length<16&&i!="unknown command"){alert("Not enought bits")}else if(s.length>16&&i!="unknown command"){alert("Too many bits")}if(t){incSC()}return s}function findRegister(e){var t=new RegExp("[0-3]","");var n=e.match(t);return n}function findAddress(e){var t=new RegExp("#[0-9]+","g");var n=new RegExp("[0-9]+","g");var r=e.match(t);r=r[0].match(n);return r}function growToNumberOfDigits(e,t){var n="";if(e.length<t){for(var r=1;r<=t-e.length;r++){n+="0"}n+=e}else if(e.length>t){alert("Input has to many bites!")}else{n=e}return n}var akku=0;var reg=new Array;reg[1]=0;reg[2]=0;reg[3]=0;var resultFiled=new Array;resultFiled[1]=0;resultFiled[2]=0;var storage=new Array;var pc=100;var sc=0;var carryFlag=false;var max=Math.pow(2,15)-1;var min=0-Math.pow(2,15);var endFlag=0;var timer