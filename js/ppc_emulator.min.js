function init(a){a=typeof a!=="undefined"?a:true;if(a){var b=document.getElementById("programmcode").getElementsByTagName("tbody")[0];for(var c=100;c<=499;c++){var d=b.insertRow(b.rows.length);d.id="row"+c;if(c%2==0){var e=document.createElement("input");e.type="text";e.value="";e.setAttribute("class","input-small");e.placeholder="Befehl";e.setAttribute("onChange","updateProgrammCode(event);");e.id="code"+c}var f=document.createElement("input");f.type="text";f.value="";f.setAttribute("class","input-medium");f.placeholder="Maschinencode";f.id="code"+c+"Bin";f.disabled=true;var g=d.insertCell(0);g.appendChild(f);var g=d.insertCell(0);if(c%2==0){g.appendChild(e)}var g=d.insertCell(0);g.innerHTML=c}}var b=document.getElementById("inputvariables").getElementsByTagName("tbody")[0];for(var c=500;c<=529;c++){var d=b.insertRow(b.rows.length);d.id="row"+c;if(c%2==0){var h=document.createElement("input");h.type="text";h.value="";h.setAttribute("class","input-small");h.placeholder="Dezimal";h.setAttribute("onChange","updateInputValue(event);");h.id="input"+c}var i=document.createElement("input");i.type="text";i.value="";i.setAttribute("class","input-medium");i.placeholder="Binär";i.id="input"+c+"Bin";i.disabled=true;var g=d.insertCell(0);g.appendChild(i);var g=d.insertCell(0);if(c%2==0){g.appendChild(h)}var g=d.insertCell(0);g.innerHTML=c;c++;var d=b.insertRow(b.rows.length);var i=document.createElement("input");i.type="text";i.value="";i.setAttribute("class","input-medium");i.placeholder="Binär";i.id="input"+c+"Bin";i.disabled=true;var g=d.insertCell(0);g.appendChild(i);var g=d.insertCell(0);var g=d.insertCell(0);g.innerHTML=c}setPC(100);sc=0;setSCinGui();setAkku(0);setReg(0,1);setReg(0,2);setReg(0,3);setCarryFlag(false);endFlag=0}function loadTest(){init(false);setStorage("LWDD 0 #504",100);setStorage("SLA",102);setStorage("BCD #124",104);setStorage("LWDD 1 #502",106);setStorage("ADD 1",108);setStorage("SLA",110);setStorage("BCD #124",112);setStorage("SLA",114);setStorage("BCD #124",116);setStorage("LWDD 1 #500",116);setStorage("ADD 1",118);setStorage("BCD #124",120);setStorage("SWDD 0 #506",122);setStorage("STOP",124);setStorage(14,500);setStorage(7,502);setStorage(66,504)}function loadTestFail(){init(false);setStorage("LWDD 0 #504",100);setStorage("SLA",102);setStorage("BCD #124",104);setStorage("LWDD 1 #502",106);setStorage("ADD 1",108);setStorage("SLA",110);setStorage("BCD #124",112);setStorage("SLA",114);setStorage("BCD #124",116);setStorage("LWDD 1 #500",116);setStorage("ADD 1",118);setStorage("BCD #124",120);setStorage("SWDD 0 #506",122);setStorage("STOP",124);setStorage(-125,500);setStorage(1e4,502);setStorage(16,504)}function stepForward(){runMnemonic(getStorage(getPC()))}function slow(){var a=setInterval(function(){if(endFlag==0){runMnemonic(getStorage(getPC()))}else{clearInterval(a)}},1e3)}function fast(){while(endFlag==0){runMnemonic(getStorage(getPC()))}}function focusOn(a){$("#code"+a).focus();$("#row"+a).addClass("info");var b=a+1;$("#row"+b).addClass("info")}function removeFocus(a){$("#row"+a).removeClass("info");var b=a+1;$("#row"+b).removeClass("info")}function setPCinGui(){$("#commandPointer").val(pc);$("#commandPointerBin").val(dec2twocomplement(pc,16))}function incPC(){removeFocus(pc);setPC(pc+2)}function setPC(a){removeFocus(pc);pc=parseInt(a);setPCinGui();focusOn(a)}function getPC(){return pc}function setSCinGui(){$("#stepcounter").val(sc)}function incSC(){sc++;setSCinGui()}function setReginGui(a){$("#reg"+a).val(reg[a]);$("#reg"+a+"Bin").val(dec2twocomplement(reg[a],16))}function setReg(a,b){if(b==0){setAkku(parseInt(a))}else{reg[b]=parseInt(a);setReginGui(b)}}function getReg(a){if(a==0){return getAkku()}else{return reg[a]}}function setAkkuinGui(){$("#akku").val(akku);$("#akkuBin").val(dec2twocomplement(akku,16))}function setAkku(a){akku=parseInt(a);if(akku>=max||akku<=min){setCarryFlag(true)}setAkkuinGui()}function getAkku(){return akku}function setCarryFlaginGui(){$("#carryFlag").attr("checked",carryFlag);if(carryFlag){$("#carryFlagRow").addClass("error")}else{$("#carryFlagRow").removeClass("error")}}function setCarryFlag(a){carryFlag=a;setCarryFlaginGui(a)}function getCarryFlag(){return carryFlag}function setStorage(a,b){storage[b]=a;if(b<500){var c="code"+b;$("#"+c).val(a);setProgrammCodeinGui(a,c,b)}else{var c="input"+b;$("#"+c).val(a);setInputValueinGui(a,c,b)}}function getStorage(a){return storage[a]}function setInputValueinGui(a,b,c){var d=dec2twocomplement(a,16);$("#"+b+"Bin").val(d.substring(0,8));var e=parseInt(c)+1;var f=b.replace(c,e);$("#"+f+"Bin").val(d.substring(8))}function setInputValueBin(a,b){var c=new RegExp("[0-9]+","g");var d=b.match(c);var e=new RegExp("input","g");var f=new RegExp("akku","g");var g=new RegExp("reg","g");var h=new RegExp("commandPointer","g");alert(b);if(e.test(b)){alert("Test");setStorage(a,d)}else if(f.test(b)){setAkku(a)}else if(f.test(b)){setReg(a,d)}else if(h.test(b)){setPC(a)}}function updateInputValue(a){var b=a.target.id;setInputValueBin(a.target.value,b)}function setProgrammCodeinGui(a,b,c){var d=mnemonic2machinecode(a);$("#"+b+"Bin").val(d.substring(0,8));var e=parseInt(c)+1;var f=b.replace(c,e);$("#"+f+"Bin").val(d.substring(8))}function setProgrammCodeBin(a,b){var c=new RegExp("[0-9]+","g");var d=b.match(c);setStorage(a,d)}function updateProgrammCode(a){var b=a.target.id;setProgrammCodeBin(a.target.value,b)}function dec2bin(a){return parseInt(a).toString(2)}function bin2dec(a){return parseInt(a,2)}function dec2twocomplement(a,b){if(a<0){var c=a.toString();var d=growToNumberOfDigits(dec2bin(c.substring(1)),b);var e="";for(i=0;i<d.length;i++){if(parseInt(d.substring(i,i+1))==1){e=e+"0"}else{e=e+"1"}}if(e.substr(e.length-1)==0){return e.substr(0,e.length-1)+"1"}else{res=parseInt(e,2)+1;return res.toString(2)}}else{return growToNumberOfDigits(dec2bin(a),b)}}function twocomplement2dec(a){var b=a.toString().substring(0,1);if(b==1){var c=parseInt(a,2)-1;c=c.toString(2);var d="";for(i=0;i<c.length;i++){if(parseInt(c.substring(i,i+1))==1){d=d+"0"}else{d=d+"1"}}return"-"+bin2dec(d)}else{return bin2dec(a)}}function mnemonic2machinecode(a){var b=defineAction(a,false);return b}function runMnemonic(a){defineAction(a,true)}function defineAction(a,b){var c=new RegExp("[a-zA-Z]+","g");var d=a.match(c);var e="";var f="";if(d=="CLR"){var g=findRegister(a);e="CLR register: "+g;f="0000"+growToNumberOfDigits(dec2bin(g),2)+"1010000000";if(b){setReg(0,g);incPC()}}else if(d=="ADD"){var g=findRegister(a);e="ADD to register: "+g;f="0000"+growToNumberOfDigits(dec2bin(g),2)+"1110000000";if(b){setAkku(getAkku()+getReg(g));incPC()}}else if(d=="ADDD"){var h=new RegExp("[-]?[1-9]+","g");var i=a.match(h);e="ADDD "+i;f="1"+dec2twocomplement(i,15);if(b){setAkku(getAkku()+i);incPC()}}else if(d=="INC"){e="INC";f="0000000100000000";if(b){setAkku(getAkku()+1);incPC()}}else if(d=="DEC"){e="DEC";f="0000010000000000";if(b){setAkku(getAkku()-1);incPC()}}else if(d=="LWDD"){var g=findRegister(a);var j=findAddress(a);e="LWDD from register: "+g+" to address "+j;f="0100"+growToNumberOfDigits(dec2bin(g),2)+growToNumberOfDigits(dec2bin(j),10);if(b){setReg(getStorage(j),g);incPC()}}else if(d=="SWDD"){var g=findRegister(a);var j=findAddress(a);e="SWDD to register: "+g+" from address "+j;f="0110"+growToNumberOfDigits(dec2bin(g),2)+growToNumberOfDigits(dec2bin(j),10);if(b){setStorage(getReg(g),j);incPC()}}else if(d=="SRA"){e="SRA";f="0000010100000000";if(b){var k=dec2twocomplement(getAkku(),16);var l=k.substring(k.length-1);var m=k.substring(0,1);var n=m+k.substring(0,k.length-1);if(l==0){setCarryFlag(false)}else{setCarryFlag(true)}setAkku(twocomplement2dec(n));incPC()}}else if(d=="SLA"){e="SLA";f="0000100000000000";if(b){var k=dec2twocomplement(getAkku(),16);var m=k.substring(0,1);var o=k.substring(1,2);var n=m+k.substring(2)+"0";if(o==0){setCarryFlag(false)}else{setCarryFlag(true)}setAkku(twocomplement2dec(n));incPC()}}else if(d=="SRL"){e="SRL";f="0000100100000000";if(b){var k=dec2twocomplement(getAkku(),16);var l=k.substring(k.length-1);var m="0";var n=m+k.substring(0,k.length-1);if(l==0){setCarryFlag(false)}else{setCarryFlag(true)}setAkku(twocomplement2dec(n));incPC()}}else if(d=="SLL"){e="SLL";f="0000110000000000";if(b){var k=dec2twocomplement(getAkku(),16);var m=k.substring(0,1);var n=k.substring(1)+"0";if(m==0){setCarryFlag(false)}else{setCarryFlag(true)}setAkku(twocomplement2dec(n));incPC()}}else if(d=="AND"){var g=findRegister(a);e="AND register: "+g;f="0000"+growToNumberOfDigits(dec2bin(g),2)+"1000000000";if(b){var p=dec2twocomplement(getAkku(),16);var q=dec2twocomplement(getReg(g));var r="";for(var s=0;s<p.length;s++){if(p.substring(s,s+1)==q.substring(s,s+1)){r+="1"}else{r+="0"}}setAkku(twocomplement2dec(r));incPC()}}else if(d=="OR"){var g=findRegister(a);e="OR register: "+g;f="0000"+growToNumberOfDigits(dec2bin(g),2)+"1100000000";if(b){var p=dec2twocomplement(getAkku(),16);var q=dec2twocomplement(getReg(g));var r="";for(var s=0;s<p.length;s++){if(p.substring(s,s+1)==1||q.substring(s,s+1)==1){r+="1"}else{r+="0"}}setAkku(twocomplement2dec(r));incPC()}}else if(d=="NOT"){e="NOT";f="0000000010000000";if(b){var p=dec2twocomplement(getAkku(),16);var r="";for(var s=0;s<p.length;s++){if(p.substring(s,s+1)==0){r+="1"}else{r+="0"}}setAkku(twocomplement2dec(r));incPC()}}else if(d=="BZ"){var g=findRegister(a);e="BZ register: "+g;f="0001"+growToNumberOfDigits(dec2bin(g),2)+"1000000000";if(b){if(getAkku()==0){setPC(getReg(g))}else{incPC()}}}else if(d=="BNZ"){var g=findRegister(a);e="BNZ register: "+g;f="0001"+growToNumberOfDigits(dec2bin(g),2)+"0100000000";if(b){if(getAkku()!=0){setPC(getReg(g))}else{incPC()}}}else if(d=="BC"){var g=findRegister(a);e="BC register: "+g;f="0001"+growToNumberOfDigits(dec2bin(g),2)+"1100000000";if(b){if(getCarryFlag()){setPC(getReg(g))}else{incPC()}}}else if(d=="B"){var g=findRegister(a);e="B register: "+g;f="0001"+growToNumberOfDigits(dec2bin(g),2)+"0000000000";if(b){setPC(getReg(g))}}else if(d=="BZD"){var j=findAddress(a);e="BZD to address "+j;f="001100"+growToNumberOfDigits(dec2bin(j),10);if(b){if(getAkku()==0){setPC(j)}else{incPC()}}}else if(d=="BNZD"){var j=findAddress(a);e="BNZD to address "+j;f="001010"+growToNumberOfDigits(dec2bin(j),10);if(b){if(getAkku()!=0){setPC(j)}else{incPC()}}}else if(d=="BCD"){var j=findAddress(a);e="BCD to address "+j;f="001110"+growToNumberOfDigits(dec2bin(j),10);if(b){if(getCarryFlag()){setPC(j)}else{incPC()}}}else if(d=="BD"){var j=findAddress(a);e="BD to address "+j;f="001000"+growToNumberOfDigits(dec2bin(j),10);if(b){setPC(j)}}else if(d=="STOP"){e="STOP";f="0000000000000000";if(b){endFlag=1;alert("END");exit}}else{e="unknown command: "+a;alert(e)}if(f.length<16&&e!="unknown command"){alert("Not enought bits")}else if(f.length>16&&e!="unknown command"){alert("Too many bits")}if(b){incSC()}return f}function findRegister(a){var b=new RegExp("[0-3]","");var c=a.match(b);return c}function findAddress(a){var b=new RegExp("#[0-9]+","g");var c=new RegExp("[0-9]+","g");var d=a.match(b);d=d[0].match(c);return d}function growToNumberOfDigits(a,b){var c="";if(a.length<b){for(var d=1;d<=b-a.length;d++){c+="0"}c+=a}else if(a.length>b){alert("Input has to many bites!")}else{c=a}return c}var akku=0;var reg=new Array;reg[1]=0;reg[2]=0;reg[3]=0;var storage=new Array;var pc=100;var sc=0;var carryFlag=false;var max=Math.pow(2,15)-1;var min=0-Math.pow(2,15);var endFlag=0